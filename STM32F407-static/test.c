#include "test.h"

int test_curve25519_static() {
	uint8_t pk_A[32];
    
	uint8_t correct_res[] = {0xd3, 0x7e, 0x13, 0xaa, 0xb8, 0x86, 0xca, 0xff, 0x84, 0x90, 0x92, 0x60, 0x60, 0xc8, 0x51, 0x55, 0x06, 0xe5, 0x69, 0x3e, 0xb9, 0xac, 0x2e, 0x4e, 0x14, 0xe5, 0xaf, 0x19, 0x4f, 0x6f, 0x67, 0x6e };

	int i;
	volatile int correct = 0;
	correct |= crypto_scalarmult_base_curve25519(pk_A/*, static_key.as_uint8_t*/);

	for(i=0;i<32;i++) {
		if(pk_A[i] != correct_res[i]) {
			correct |= 1;
			break;
		}
	}
	correct |= crypto_scalarmult_base_curve25519(pk_A/*, static_key.as_uint8_t*/);
	for(i=0;i<32;i++) {
		if(pk_A[i] != correct_res[i]) {
			correct |= 2;
			break;
		}
	}

	return correct;
}

int test_point() {
  // correct point
  uint8_t out_point[32];
  //uint8_t input_point[] = {0xC7, 0xF3, 0x62, 0xBE, 0xCC, 0xE6, 0x2D, 0xD1, 0x37, 0x82, 0x67, 0x81, 0x8A, 0x85, 0x19, 0xAC, 0xF8, 0xF4, 0x81, 0x60, 0xFA, 0xD8, 0x3D, 0x55, 0x1D, 0xCB, 0x97, 0xC1, 0x19, 0x83, 0xDB, 0x61};
  //uint8_t input_point[] = {0x2C, 0xA5, 0x0D, 0x15, 0xA3, 0x55, 0x8D, 0x9A, 0x77, 0x87, 0xA0, 0xFB, 0x87, 0x80, 0x6C, 0x58, 0x6F, 0xEF, 0xF5, 0x5B, 0x9D, 0x10, 0xA6, 0xC4, 0xF0, 0xBB, 0xA1, 0xEC, 0x76, 0x3B, 0x4A, 0x8E};

  uint8_t input_point[32];
  uint8_t out_point1[32], out_point2[32];
  int i, j;
  int retval = 0;
  int out = 0;
  for(i=0;i<10;i++) {
    randombytes(&input_point, 32);
    out = crypto_scalarmult_curve25519(out_point1, input_point);
    crypto_scalarmult_curve25519(out_point2, input_point);
    if(out != 0)
      continue;
    for(j=0;j<32;j++) {
      if(out_point1[j] != out_point2[j]) {
        retval |= i;
      }
    }
  }

  volatile int bb = 10;

  return retval;
}
